{"ast":null,"code":"var _jsxFileName = \"/home/fusion/workspace/frontend/src/ui/pages/productPage/components/Comments/Comments.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from 'react';\nimport { useFormik } from 'formik';\nimport dayjs from 'dayjs';\nimport { toast } from 'react-toastify';\nimport relativeTime from 'dayjs/plugin/relativeTime';\nimport { socket } from '../../../../../App';\nimport bookApi from '../../../../../api/bookApi';\nimport { useAppSelector } from '../../../../../store';\nimport AuthProtector from '../../../../components/AuthProtector';\nimport CommonButton from '../../../../components/CommonButton';\nimport CommentsWrapper from './Comments.styles';\nimport defaultAvatar from '../../../../images/default-avatar.png';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Comments = props => {\n  _s();\n\n  const user = useAppSelector(state => state.userReducer.user);\n  const commentsArray = props.book.comments;\n  const formik = useFormik({\n    initialValues: {\n      text: ''\n    },\n    onSubmit: async value => {\n      try {\n        if (!user) {\n          return;\n        }\n\n        const newComment = {\n          text: value.text.trim(),\n          bookId: props.book.bookId\n        };\n        const response = await bookApi.addComment(newComment);\n        value.text = '';\n        socket.emit('comment:add', response.data);\n      } catch (error) {\n        toast.error('Sorry, something went wrong...', {\n          autoClose: 3000\n        });\n      }\n    }\n  });\n  useEffect(() => {\n    socket.on('comment:save', data => {\n      props.book.comments.push(data);\n      const book = { ...props.book\n      };\n      props.setBookInState(book);\n    });\n  }, [socket]);\n\n  const dateToDateAgo = date => {\n    dayjs.extend(relativeTime);\n    const newDate = dayjs(date).fromNow();\n    return `Left a comment ${newDate}`;\n  };\n\n  return /*#__PURE__*/_jsxDEV(CommentsWrapper, {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"title\",\n      children: \"Comments\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this), commentsArray.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"comments\",\n      children: commentsArray.map(comment => {\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"comment\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: comment.user.avatar || defaultAvatar,\n            className: \"avatar\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 73,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"content-block\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"author-name\",\n              children: comment.user.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 77,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"date\",\n              children: dateToDateAgo(comment.date)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 78,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 76,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text\",\n            children: comment.text\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 15\n          }, this)]\n        }, comment.commentId, true, {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 13\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 36\n    }, this), /*#__PURE__*/_jsxDEV(AuthProtector, {\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: formik.handleSubmit,\n        className: \"comment__form\",\n        children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n          placeholder: \"Share a comment\",\n          className: \"textarea comment\",\n          rows: 3,\n          ...formik.getFieldProps('text')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(CommonButton, {\n          size: \"permanent\",\n          text: \"Post a comment\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Comments, \"s/wfLjNCup4aEwuZ40E9meUsVZ4=\", false, function () {\n  return [useAppSelector, useFormik];\n});\n\n_c = Comments;\nexport default Comments;\n\nvar _c;\n\n$RefreshReg$(_c, \"Comments\");","map":{"version":3,"names":["React","useEffect","useFormik","dayjs","toast","relativeTime","socket","bookApi","useAppSelector","AuthProtector","CommonButton","CommentsWrapper","defaultAvatar","Comments","props","user","state","userReducer","commentsArray","book","comments","formik","initialValues","text","onSubmit","value","newComment","trim","bookId","response","addComment","emit","data","error","autoClose","on","push","setBookInState","dateToDateAgo","date","extend","newDate","fromNow","length","map","comment","avatar","name","commentId","handleSubmit","getFieldProps"],"sources":["/home/fusion/workspace/frontend/src/ui/pages/productPage/components/Comments/Comments.tsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { useFormik } from 'formik';\nimport dayjs from 'dayjs';\nimport { toast } from 'react-toastify';\nimport relativeTime from 'dayjs/plugin/relativeTime';\n\nimport { socket } from '../../../../../App';\nimport bookApi from '../../../../../api/bookApi';\nimport { BookType, Comment } from '../../../../../types';\nimport { useAppSelector } from '../../../../../store';\n\nimport AuthProtector from '../../../../components/AuthProtector';\nimport CommonButton from '../../../../components/CommonButton';\n\nimport CommentsWrapper from './Comments.styles';\n\nimport defaultAvatar from '../../../../images/default-avatar.png';\n\ntype CommentsProps = {\n  book: BookType,\n  setBookInState: (data: BookType) => void,\n}\n\nconst Comments: React.FC<CommentsProps> = (props) => {\n  const user = useAppSelector((state) => state.userReducer.user);\n  const commentsArray = props.book.comments;\n\n  const formik = useFormik({\n    initialValues: {\n      text: '',\n    },\n    onSubmit: async (value) => {\n      try {\n        if (!user) { return; }\n        const newComment = {\n          text: value.text.trim(),\n          bookId: props.book.bookId,\n        };\n        const response = await bookApi.addComment(newComment);\n        value.text = '';\n\n        socket.emit('comment:add', response.data);\n      } catch (error) {\n        toast.error('Sorry, something went wrong...', { autoClose: 3000 });\n      }\n    },\n  });\n\n  useEffect(() => {\n    socket.on('comment:save', (data: Comment) => {\n      props.book.comments.push(data);\n      const book = { ...props.book };\n      props.setBookInState(book);\n    });\n  }, [socket]);\n\n  const dateToDateAgo = (date: string) => {\n    dayjs.extend(relativeTime);\n    const newDate = dayjs(date).fromNow();\n    return `Left a comment ${newDate}`;\n  };\n\n  return (\n    <CommentsWrapper>\n      <h1 className=\"title\">Comments</h1>\n      {commentsArray.length > 0 && <div className=\"comments\">\n        {commentsArray.map((comment) => {\n          return (\n            <div\n              key={comment.commentId}\n              className=\"comment\"\n            >\n              <img\n                src={comment.user.avatar || defaultAvatar}\n                className=\"avatar\" />\n              <div className=\"content-block\">\n                <p className=\"author-name\">{comment.user.name}</p>\n                <p className=\"date\">{dateToDateAgo(comment.date)}</p>\n              </div>\n              <p className=\"text\">{comment.text}</p>\n            </div>\n          );\n        })}\n      </div>}\n      <AuthProtector>\n        <form\n          onSubmit={formik.handleSubmit}\n          className=\"comment__form\"\n        >\n          <textarea\n            placeholder=\"Share a comment\"\n            className=\"textarea comment\"\n            rows={3}\n            {...formik.getFieldProps('text')}\n          />\n          <CommonButton\n            size=\"permanent\"\n            text=\"Post a comment\"\n          />\n        </form>\n      </AuthProtector>\n    </CommentsWrapper>\n  );\n};\n\nexport default Comments;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}