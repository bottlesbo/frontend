{"ast":null,"code":"import _asyncToGenerator from\"/home/father/bookstore/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/father/bookstore/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/father/bookstore/frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState}from'react';import{AxiosError}from'axios';import{toast}from'react-toastify';import{useFormik}from'formik';import YupString from'yup/lib/string';import YupObject from'yup/lib/object';import YupRef from'yup/lib/Reference';import userApi from'../../../../api/userApi';import{useAppSelector}from'../../../../store';import CommonInputField from'../../../components/CommonInputField';import CommonButton from'../../../components/CommonButton';import hideIcon from'../../../images/hide.png';import showIcon from'../../../images/view.png';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var changePasswordValidationSchema=new YupObject().shape({oldPassword:new YupString().required('Required'),password:new YupString().required('Required'),passwordRepeat:new YupString().when('password',{is:function is(value){return Boolean(value&&value.length>0);},then:new YupString().oneOf([new YupRef('password')],'Both passwords need to be the same')})});var UserPassword=function UserPassword(props){var user=useAppSelector(function(state){return state.userReducer.user;});var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isPasswordVisible=_useState2[0],setIsPasswordVisible=_useState2[1];var formik=useFormik({initialValues:{oldPassword:'',password:'',passwordRepeat:''},validationSchema:changePasswordValidationSchema,onSubmit:function(){var _onSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var password,oldPassword,_error$response,status,_error$response2;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;password=values.password,oldPassword=values.oldPassword;_context.next=4;return userApi.updateUser(user.id,{oldPassword:oldPassword,password:password});case 4:props.toggleChangePassword();formik.setStatus('Success!');setTimeout(function(){formik.setStatus(false);},2000);_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);if(_context.t0 instanceof AxiosError){status=(_error$response=_context.t0.response)===null||_error$response===void 0?void 0:_error$response.status;if(status===403){formik.setErrors({oldPassword:(_error$response2=_context.t0.response)===null||_error$response2===void 0?void 0:_error$response2.data.data.message});}}else{toast.error('Sorry, something went wrong...',{autoClose:3000});}case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));function onSubmit(_x){return _onSubmit.apply(this,arguments);}return onSubmit;}()});var icon=isPasswordVisible?showIcon:hideIcon;var inputType=isPasswordVisible?'text':'password';var togglePasswordVisibility=function togglePasswordVisibility(){setIsPasswordVisible(!isPasswordVisible);};if(props.isChangePassword){return/*#__PURE__*/_jsx(CommonInputField,{icon:hideIcon,name:\"password\",hint:\"Your password\",placeholder:\"********\",disabled:true,success:formik.status});}return/*#__PURE__*/_jsxs(\"form\",{onKeyDown:function onKeyDown(e){if(e.key==='Enter'){formik.handleSubmit();}},onSubmit:formik.handleSubmit,children:[/*#__PURE__*/_jsx(CommonInputField,{icon:icon,name:\"oldPassword\",hint:\"Old password\",placeholder:\"*************\",type:inputType,fieldInputProps:formik.getFieldProps('oldPassword'),error:formik!==null&&formik!==void 0&&formik.touched.oldPassword?formik===null||formik===void 0?void 0:formik.errors.oldPassword:'',onClickOnIcon:togglePasswordVisibility}),/*#__PURE__*/_jsx(CommonInputField,{icon:icon,name:\"password\",type:\"password\",placeholder:\"New password\",fieldInputProps:formik.getFieldProps('password'),error:formik!==null&&formik!==void 0&&formik.touched.password?formik===null||formik===void 0?void 0:formik.errors.password:'',onClickOnIcon:togglePasswordVisibility}),/*#__PURE__*/_jsx(\"p\",{children:\"Enter your password\"}),/*#__PURE__*/_jsx(CommonInputField,{icon:icon,placeholder:\"Password replay\",type:\"password\",name:\"passwordRepeat\",fieldInputProps:formik.getFieldProps('passwordRepeat'),error:formik!==null&&formik!==void 0&&formik.touched.passwordRepeat?formik===null||formik===void 0?void 0:formik.errors.passwordRepeat:'',onClickOnIcon:togglePasswordVisibility}),/*#__PURE__*/_jsx(\"p\",{children:\"Repeat your passport withour errors\"}),/*#__PURE__*/_jsx(CommonButton,{text:\"Confirm\"})]});};export default UserPassword;","map":{"version":3,"names":["React","useState","AxiosError","toast","useFormik","YupString","YupObject","YupRef","userApi","useAppSelector","CommonInputField","CommonButton","hideIcon","showIcon","changePasswordValidationSchema","shape","oldPassword","required","password","passwordRepeat","when","is","value","Boolean","length","then","oneOf","UserPassword","props","user","state","userReducer","isPasswordVisible","setIsPasswordVisible","formik","initialValues","validationSchema","onSubmit","values","updateUser","id","toggleChangePassword","setStatus","setTimeout","status","response","setErrors","data","message","error","autoClose","icon","inputType","togglePasswordVisibility","isChangePassword","e","key","handleSubmit","getFieldProps","touched","errors"],"sources":["/home/father/bookstore/frontend/src/ui/pages/userProfile/components/UserPassword.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { AxiosError } from 'axios';\nimport { toast } from 'react-toastify';\nimport { useFormik } from 'formik';\n\nimport YupString from 'yup/lib/string';\nimport YupObject from 'yup/lib/object';\nimport YupRef from 'yup/lib/Reference';\n\nimport userApi from '../../../../api/userApi';\nimport { useAppSelector } from '../../../../store';\nimport { User } from '../../../../types';\n\nimport CommonInputField from '../../../components/CommonInputField';\nimport CommonButton from '../../../components/CommonButton';\n\nimport hideIcon from '../../../images/hide.png';\nimport showIcon from '../../../images/view.png';\n\ntype UserProfileProps = {\n  isChangePassword: boolean;\n  toggleChangePassword: () => void;\n}\n\nconst changePasswordValidationSchema = new YupObject().shape({\n  oldPassword: new YupString().required('Required'),\n  password: new YupString().required('Required'),\n  passwordRepeat: new YupString().when('password', {\n    is: (value: string) => (Boolean(value && value.length > 0)),\n    then: new YupString().oneOf(\n      [new YupRef('password')],\n      'Both passwords need to be the same',\n    ),\n  }),\n});\n\nconst UserPassword: React.FC<UserProfileProps> = (props) => {\n  const user = useAppSelector((state) => state.userReducer.user) as User;\n  const [isPasswordVisible, setIsPasswordVisible] = useState(false);\n\n  const formik = useFormik({\n    initialValues: {\n      oldPassword: '',\n      password: '',\n      passwordRepeat: '',\n    },\n    validationSchema: changePasswordValidationSchema,\n    onSubmit: async (values) => {\n      try {\n        const { password, oldPassword } = values;\n        await userApi.updateUser(user.id, { oldPassword, password });\n        props.toggleChangePassword();\n        formik.setStatus('Success!');\n        setTimeout(() => {\n          formik.setStatus(false);\n        }, 2000);\n      } catch (error) {\n        if (error instanceof AxiosError) {\n          const status = error.response?.status;\n          if (status === 403) {\n            formik.setErrors({\n              oldPassword: error.response?.data.data.message,\n            });\n          }\n        } else {\n          toast.error('Sorry, something went wrong...', { autoClose: 3000 });\n        }\n      }\n    },\n  });\n\n  const icon = isPasswordVisible ? showIcon : hideIcon;\n  const inputType = isPasswordVisible ? 'text' : 'password';\n\n  const togglePasswordVisibility = () => {\n    setIsPasswordVisible(!isPasswordVisible);\n  };\n\n  if (props.isChangePassword) {\n    return (\n      <CommonInputField\n        icon={hideIcon}\n        name=\"password\"\n        hint=\"Your password\"\n        placeholder=\"********\"\n        disabled={true}\n        success={formik.status}\n      />\n    );\n  }\n  return (\n    <form\n      onKeyDown={(e) => {\n        if (e.key === 'Enter') {\n          formik.handleSubmit();\n        }\n      }}\n      onSubmit={formik.handleSubmit}\n    >\n      <CommonInputField\n        icon={icon}\n        name=\"oldPassword\"\n        hint=\"Old password\"\n        placeholder=\"*************\"\n        type={inputType}\n        fieldInputProps={formik.getFieldProps('oldPassword')}\n        error={formik?.touched.oldPassword ? formik?.errors.oldPassword : ''}\n        onClickOnIcon={togglePasswordVisibility}\n      />\n      <CommonInputField\n        icon={icon}\n        name=\"password\"\n        type=\"password\"\n        placeholder=\"New password\"\n        fieldInputProps={formik.getFieldProps('password')}\n        error={formik?.touched.password ? formik?.errors.password : ''}\n        onClickOnIcon={togglePasswordVisibility}\n      />\n      <p>Enter your password</p>\n      <CommonInputField\n        icon={icon}\n        placeholder=\"Password replay\"\n        type=\"password\"\n        name=\"passwordRepeat\"\n        fieldInputProps={formik.getFieldProps('passwordRepeat')}\n        error={formik?.touched.passwordRepeat ? formik?.errors.passwordRepeat : ''}\n        onClickOnIcon={togglePasswordVisibility}\n      />\n      <p>Repeat your passport withour errors</p>\n      <CommonButton\n        text=\"Confirm\"\n      />\n    </form>\n  );\n};\n\nexport default UserPassword;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}