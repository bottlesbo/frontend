{"ast":null,"code":"import _objectSpread from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect}from'react';import{useFormik}from'formik';import dayjs from'dayjs';import{toast}from'react-toastify';import relativeTime from'dayjs/plugin/relativeTime';import{socket}from'../../../../../App';import bookApi from'../../../../../api/bookApi';import{useAppSelector}from'../../../../../store';import AuthProtector from'../../../../components/AuthProtector';import CommonButton from'../../../../components/CommonButton';import CommentsWrapper from'./Comments.styles';import defaultAvatar from'../../../../images/default-avatar.png';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Comments=function Comments(props){var user=useAppSelector(function(state){return state.userReducer.user;});var commentsArray=props.book.comments;var formik=useFormik({initialValues:{text:''},onSubmit:function(){var _onSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(value){var newComment,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(user){_context.next=3;break;}return _context.abrupt(\"return\");case 3:newComment={text:value.text.trim(),bookId:props.book.bookId};_context.next=6;return bookApi.addComment(newComment);case 6:response=_context.sent;value.text='';socket.emit('comment:add',response.data);_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);toast.error('Sorry, something went wrong...',{autoClose:3000});case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));function onSubmit(_x){return _onSubmit.apply(this,arguments);}return onSubmit;}()});useEffect(function(){socket.on('comment:save',function(data){props.book.comments.push(data);var book=_objectSpread({},props.book);props.setBookInState(book);});},[socket]);var dateToDateAgo=function dateToDateAgo(date){dayjs.extend(relativeTime);var newDate=dayjs(date).fromNow();return\"Left a comment \".concat(newDate);};return/*#__PURE__*/_jsxs(CommentsWrapper,{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"title\",children:\"Comments\"}),commentsArray.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"comments\",children:commentsArray.map(function(comment){return/*#__PURE__*/_jsxs(\"div\",{className:\"comment\",children:[/*#__PURE__*/_jsx(\"img\",{src:comment.user.avatar||defaultAvatar,className:\"avatar\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"content-block\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"author-name\",children:comment.user.name}),/*#__PURE__*/_jsx(\"p\",{className:\"date\",children:dateToDateAgo(comment.date)})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text\",children:comment.text})]},comment.commentId);})}),/*#__PURE__*/_jsx(AuthProtector,{children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:formik.handleSubmit,className:\"comment__form\",children:[/*#__PURE__*/_jsx(\"textarea\",_objectSpread({placeholder:\"Share a comment\",className:\"textarea comment\",rows:3},formik.getFieldProps('text'))),/*#__PURE__*/_jsx(CommonButton,{size:\"permanent\",text:\"Post a comment\"})]})})]});};export default Comments;","map":{"version":3,"names":["React","useEffect","useFormik","dayjs","toast","relativeTime","socket","bookApi","useAppSelector","AuthProtector","CommonButton","CommentsWrapper","defaultAvatar","Comments","props","user","state","userReducer","commentsArray","book","comments","formik","initialValues","text","onSubmit","value","newComment","trim","bookId","addComment","response","emit","data","error","autoClose","on","push","setBookInState","dateToDateAgo","date","extend","newDate","fromNow","length","map","comment","avatar","name","commentId","handleSubmit","getFieldProps"],"sources":["/home/fusion/workspace/frontend/src/ui/pages/productPage/components/Comments/Comments.tsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { useFormik } from 'formik';\nimport dayjs from 'dayjs';\nimport { toast } from 'react-toastify';\nimport relativeTime from 'dayjs/plugin/relativeTime';\n\nimport { socket } from '../../../../../App';\nimport bookApi from '../../../../../api/bookApi';\nimport { BookType, Comment } from '../../../../../types';\nimport { useAppSelector } from '../../../../../store';\n\nimport AuthProtector from '../../../../components/AuthProtector';\nimport CommonButton from '../../../../components/CommonButton';\n\nimport CommentsWrapper from './Comments.styles';\n\nimport defaultAvatar from '../../../../images/default-avatar.png';\n\ntype CommentsProps = {\n  book: BookType,\n  setBookInState: (data: BookType) => void,\n}\n\nconst Comments: React.FC<CommentsProps> = (props) => {\n  const user = useAppSelector((state) => state.userReducer.user);\n  const commentsArray = props.book.comments;\n\n  const formik = useFormik({\n    initialValues: {\n      text: '',\n    },\n    onSubmit: async (value) => {\n      try {\n        if (!user) { return; }\n        const newComment = {\n          text: value.text.trim(),\n          bookId: props.book.bookId,\n        };\n        const response = await bookApi.addComment(newComment);\n        value.text = '';\n\n        socket.emit('comment:add', response.data);\n      } catch (error) {\n        toast.error('Sorry, something went wrong...', { autoClose: 3000 });\n      }\n    },\n  });\n\n  useEffect(() => {\n    socket.on('comment:save', (data: Comment) => {\n      props.book.comments.push(data);\n      const book = { ...props.book };\n      props.setBookInState(book);\n    });\n  }, [socket]);\n\n  const dateToDateAgo = (date: string) => {\n    dayjs.extend(relativeTime);\n    const newDate = dayjs(date).fromNow();\n    return `Left a comment ${newDate}`;\n  };\n\n  return (\n    <CommentsWrapper>\n      <h1 className=\"title\">Comments</h1>\n      {commentsArray.length > 0 && <div className=\"comments\">\n        {commentsArray.map((comment) => {\n          return (\n            <div\n              key={comment.commentId}\n              className=\"comment\"\n            >\n              <img\n                src={comment.user.avatar || defaultAvatar}\n                className=\"avatar\" />\n              <div className=\"content-block\">\n                <p className=\"author-name\">{comment.user.name}</p>\n                <p className=\"date\">{dateToDateAgo(comment.date)}</p>\n              </div>\n              <p className=\"text\">{comment.text}</p>\n            </div>\n          );\n        })}\n      </div>}\n      <AuthProtector>\n        <form\n          onSubmit={formik.handleSubmit}\n          className=\"comment__form\"\n        >\n          <textarea\n            placeholder=\"Share a comment\"\n            className=\"textarea comment\"\n            rows={3}\n            {...formik.getFieldProps('text')}\n          />\n          <CommonButton\n            size=\"permanent\"\n            text=\"Post a comment\"\n          />\n        </form>\n      </AuthProtector>\n    </CommentsWrapper>\n  );\n};\n\nexport default Comments;\n"],"mappings":"iWAAA,MAAOA,MAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,SAAT,KAA0B,QAA1B,CACA,MAAOC,MAAP,KAAkB,OAAlB,CACA,OAASC,KAAT,KAAsB,gBAAtB,CACA,MAAOC,aAAP,KAAyB,2BAAzB,CAEA,OAASC,MAAT,KAAuB,oBAAvB,CACA,MAAOC,QAAP,KAAoB,4BAApB,CAEA,OAASC,cAAT,KAA+B,sBAA/B,CAEA,MAAOC,cAAP,KAA0B,sCAA1B,CACA,MAAOC,aAAP,KAAyB,qCAAzB,CAEA,MAAOC,gBAAP,KAA4B,mBAA5B,CAEA,MAAOC,cAAP,KAA0B,uCAA1B,C,wFAOA,GAAMC,SAAiC,CAAG,QAApCA,SAAoC,CAACC,KAAD,CAAW,CACnD,GAAMC,KAAI,CAAGP,cAAc,CAAC,SAACQ,KAAD,QAAWA,MAAK,CAACC,WAAN,CAAkBF,IAA7B,EAAD,CAA3B,CACA,GAAMG,cAAa,CAAGJ,KAAK,CAACK,IAAN,CAAWC,QAAjC,CAEA,GAAMC,OAAM,CAAGnB,SAAS,CAAC,CACvBoB,aAAa,CAAE,CACbC,IAAI,CAAE,EADO,CADQ,CAIvBC,QAAQ,kFAAE,iBAAOC,KAAP,6JAEDV,IAFC,iEAGAW,UAHA,CAGa,CACjBH,IAAI,CAAEE,KAAK,CAACF,IAAN,CAAWI,IAAX,EADW,CAEjBC,MAAM,CAAEd,KAAK,CAACK,IAAN,CAAWS,MAFF,CAHb,uBAOiBrB,QAAO,CAACsB,UAAR,CAAmBH,UAAnB,CAPjB,QAOAI,QAPA,eAQNL,KAAK,CAACF,IAAN,CAAa,EAAb,CAEAjB,MAAM,CAACyB,IAAP,CAAY,aAAZ,CAA2BD,QAAQ,CAACE,IAApC,EAVM,iFAYN5B,KAAK,CAAC6B,KAAN,CAAY,gCAAZ,CAA8C,CAAEC,SAAS,CAAE,IAAb,CAA9C,EAZM,qEAAF,oFAJe,CAAD,CAAxB,CAqBAjC,SAAS,CAAC,UAAM,CACdK,MAAM,CAAC6B,EAAP,CAAU,cAAV,CAA0B,SAACH,IAAD,CAAmB,CAC3ClB,KAAK,CAACK,IAAN,CAAWC,QAAX,CAAoBgB,IAApB,CAAyBJ,IAAzB,EACA,GAAMb,KAAI,kBAAQL,KAAK,CAACK,IAAd,CAAV,CACAL,KAAK,CAACuB,cAAN,CAAqBlB,IAArB,EACD,CAJD,EAKD,CANQ,CAMN,CAACb,MAAD,CANM,CAAT,CAQA,GAAMgC,cAAa,CAAG,QAAhBA,cAAgB,CAACC,IAAD,CAAkB,CACtCpC,KAAK,CAACqC,MAAN,CAAanC,YAAb,EACA,GAAMoC,QAAO,CAAGtC,KAAK,CAACoC,IAAD,CAAL,CAAYG,OAAZ,EAAhB,CACA,+BAAyBD,OAAzB,EACD,CAJD,CAMA,mBACE,MAAC,eAAD,yBACE,WAAI,SAAS,CAAC,OAAd,sBADF,CAEGvB,aAAa,CAACyB,MAAd,CAAuB,CAAvB,eAA4B,YAAK,SAAS,CAAC,UAAf,UAC1BzB,aAAa,CAAC0B,GAAd,CAAkB,SAACC,OAAD,CAAa,CAC9B,mBACE,aAEE,SAAS,CAAC,SAFZ,wBAIE,YACE,GAAG,CAAEA,OAAO,CAAC9B,IAAR,CAAa+B,MAAb,EAAuBlC,aAD9B,CAEE,SAAS,CAAC,QAFZ,EAJF,cAOE,aAAK,SAAS,CAAC,eAAf,wBACE,UAAG,SAAS,CAAC,aAAb,UAA4BiC,OAAO,CAAC9B,IAAR,CAAagC,IAAzC,EADF,cAEE,UAAG,SAAS,CAAC,MAAb,UAAqBT,aAAa,CAACO,OAAO,CAACN,IAAT,CAAlC,EAFF,GAPF,cAWE,UAAG,SAAS,CAAC,MAAb,UAAqBM,OAAO,CAACtB,IAA7B,EAXF,GACOsB,OAAO,CAACG,SADf,CADF,CAeD,CAhBA,CAD0B,EAF/B,cAqBE,KAAC,aAAD,wBACE,cACE,QAAQ,CAAE3B,MAAM,CAAC4B,YADnB,CAEE,SAAS,CAAC,eAFZ,wBAIE,+BACE,WAAW,CAAC,iBADd,CAEE,SAAS,CAAC,kBAFZ,CAGE,IAAI,CAAE,CAHR,EAIM5B,MAAM,CAAC6B,aAAP,CAAqB,MAArB,CAJN,EAJF,cAUE,KAAC,YAAD,EACE,IAAI,CAAC,WADP,CAEE,IAAI,CAAC,gBAFP,EAVF,GADF,EArBF,GADF,CAyCD,CAhFD,CAkFA,cAAerC,SAAf"},"metadata":{},"sourceType":"module"}