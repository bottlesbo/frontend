{"ast":null,"code":"import _objectSpread from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/regenerator/index.js\";import axios from'axios';import Cookies from'js-cookie';import config from'../config';import constants from'../constants';import checkRefreshToken from'../utils/checkRefreshToken';import logOut from'../utils/logOut';var instance=axios.create({baseURL:config.apiBaseUrl});instance.interceptors.request.use(function(config){var token=Cookies.get(constants.token.access);if(token){if(!config.headers){config.headers={};}config.headers.authorization=\"Bearer \".concat(token);}return config;});var isCheckRefreshJWTSend=null;instance.interceptors.response.use(function(response){if(response.data==='OK'){return response;}if('token'in response.data){var _response$data;Cookies.set(constants.token.access,response.data.token);Cookies.set(constants.token.refresh,(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.refreshToken);}return response;},/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(err){var isChecked,req;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(err.response.status===401&&err.response.data.data.message==='Token expired')){_context.next=12;break;}if(!isCheckRefreshJWTSend){isCheckRefreshJWTSend=checkRefreshToken();}_context.next=4;return isCheckRefreshJWTSend;case 4:isChecked=_context.sent;if(!isChecked){_context.next=10;break;}req=_objectSpread({},err.config);req.headers.authorization=\"Bearer \".concat(Cookies.get(constants.token.access));isCheckRefreshJWTSend=null;return _context.abrupt(\"return\",axios.request(req));case 10:_context.next=14;break;case 12:if(!(err.response.status===401&&err.response.data.data.message==='Refresh token expired')){_context.next=14;break;}return _context.abrupt(\"return\",logOut());case 14:return _context.abrupt(\"return\",Promise.reject(err));case 15:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());export default instance;","map":{"version":3,"names":["axios","Cookies","config","constants","checkRefreshToken","logOut","instance","create","baseURL","apiBaseUrl","interceptors","request","use","token","get","access","headers","authorization","isCheckRefreshJWTSend","response","data","set","refresh","refreshToken","err","status","message","isChecked","req","Promise","reject"],"sources":["/home/fusion/workspace/frontend/src/api/axios.ts"],"sourcesContent":["import axios from 'axios';\nimport Cookies from 'js-cookie';\n\nimport config from '../config';\nimport constants from '../constants';\n\nimport checkRefreshToken from '../utils/checkRefreshToken';\nimport logOut from '../utils/logOut';\n\nconst instance = axios.create({\n  baseURL: config.apiBaseUrl,\n});\n\ninstance.interceptors.request.use((config) => {\n  const token = Cookies.get(constants.token.access);\n  if (token) {\n    if (!config.headers) {\n      config.headers = {};\n    }\n    config.headers.authorization = `Bearer ${token}`;\n  }\n\n  return config;\n});\n\nlet isCheckRefreshJWTSend: Promise<boolean> | null = null;\n\ninstance.interceptors.response.use((response) => {\n  if (response.data === 'OK') {\n    return response;\n  }\n\n  if ('token' in response.data) {\n    Cookies.set(constants.token.access, response.data.token);\n    Cookies.set(constants.token.refresh, response.data?.refreshToken);\n  }\n\n  return response;\n}, async (err) => {\n  if (\n    err.response.status === 401 &&\n    err.response.data.data.message === 'Token expired'\n  ) {\n    if (!isCheckRefreshJWTSend) {\n      isCheckRefreshJWTSend = checkRefreshToken();\n    }\n    const isChecked = await isCheckRefreshJWTSend;\n    if (isChecked) {\n      const req = { ...err.config };\n      req.headers.authorization = `Bearer ${Cookies.get(constants.token.access)}`;\n\n      isCheckRefreshJWTSend = null;\n\n      return axios.request(req);\n    }\n  } else if (\n    err.response.status === 401 &&\n    err.response.data.data.message === 'Refresh token expired'\n  ) {\n    return logOut();\n  }\n\n  return Promise.reject(err);\n});\n\nexport default instance;\n"],"mappings":"iWAAA,MAAOA,MAAP,KAAkB,OAAlB,CACA,MAAOC,QAAP,KAAoB,WAApB,CAEA,MAAOC,OAAP,KAAmB,WAAnB,CACA,MAAOC,UAAP,KAAsB,cAAtB,CAEA,MAAOC,kBAAP,KAA8B,4BAA9B,CACA,MAAOC,OAAP,KAAmB,iBAAnB,CAEA,GAAMC,SAAQ,CAAGN,KAAK,CAACO,MAAN,CAAa,CAC5BC,OAAO,CAAEN,MAAM,CAACO,UADY,CAAb,CAAjB,CAIAH,QAAQ,CAACI,YAAT,CAAsBC,OAAtB,CAA8BC,GAA9B,CAAkC,SAACV,MAAD,CAAY,CAC5C,GAAMW,MAAK,CAAGZ,OAAO,CAACa,GAAR,CAAYX,SAAS,CAACU,KAAV,CAAgBE,MAA5B,CAAd,CACA,GAAIF,KAAJ,CAAW,CACT,GAAI,CAACX,MAAM,CAACc,OAAZ,CAAqB,CACnBd,MAAM,CAACc,OAAP,CAAiB,EAAjB,CACD,CACDd,MAAM,CAACc,OAAP,CAAeC,aAAf,kBAAyCJ,KAAzC,EACD,CAED,MAAOX,OAAP,CACD,CAVD,EAYA,GAAIgB,sBAA8C,CAAG,IAArD,CAEAZ,QAAQ,CAACI,YAAT,CAAsBS,QAAtB,CAA+BP,GAA/B,CAAmC,SAACO,QAAD,CAAc,CAC/C,GAAIA,QAAQ,CAACC,IAAT,GAAkB,IAAtB,CAA4B,CAC1B,MAAOD,SAAP,CACD,CAED,GAAI,SAAWA,SAAQ,CAACC,IAAxB,CAA8B,oBAC5BnB,OAAO,CAACoB,GAAR,CAAYlB,SAAS,CAACU,KAAV,CAAgBE,MAA5B,CAAoCI,QAAQ,CAACC,IAAT,CAAcP,KAAlD,EACAZ,OAAO,CAACoB,GAAR,CAAYlB,SAAS,CAACU,KAAV,CAAgBS,OAA5B,iBAAqCH,QAAQ,CAACC,IAA9C,yCAAqC,eAAeG,YAApD,EACD,CAED,MAAOJ,SAAP,CACD,CAXD,0FAWG,iBAAOK,GAAP,yIAECA,GAAG,CAACL,QAAJ,CAAaM,MAAb,GAAwB,GAAxB,EACAD,GAAG,CAACL,QAAJ,CAAaC,IAAb,CAAkBA,IAAlB,CAAuBM,OAAvB,GAAmC,eAHpC,2BAKC,GAAI,CAACR,qBAAL,CAA4B,CAC1BA,qBAAqB,CAAGd,iBAAiB,EAAzC,CACD,CAPF,sBAQyBc,sBARzB,QAQOS,SARP,mBASKA,SATL,0BAUSC,GAVT,kBAUoBJ,GAAG,CAACtB,MAVxB,EAWG0B,GAAG,CAACZ,OAAJ,CAAYC,aAAZ,kBAAsChB,OAAO,CAACa,GAAR,CAAYX,SAAS,CAACU,KAAV,CAAgBE,MAA5B,CAAtC,EAEAG,qBAAqB,CAAG,IAAxB,CAbH,gCAeUlB,KAAK,CAACW,OAAN,CAAciB,GAAd,CAfV,8CAkBCJ,GAAG,CAACL,QAAJ,CAAaM,MAAb,GAAwB,GAAxB,EACAD,GAAG,CAACL,QAAJ,CAAaC,IAAb,CAAkBA,IAAlB,CAAuBM,OAAvB,GAAmC,uBAnBpC,2DAqBQrB,MAAM,EArBd,0CAwBMwB,OAAO,CAACC,MAAR,CAAeN,GAAf,CAxBN,yDAXH,gEAsCA,cAAelB,SAAf"},"metadata":{},"sourceType":"module"}