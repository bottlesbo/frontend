{"ast":null,"code":"import _asyncToGenerator from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect,useState}from'react';import{useNavigate,useParams}from'react-router';import{toast}from'react-toastify';import bookApi from'../../../api/bookApi';import{useAppSelector}from'../../../store';import{routePath}from'../../../constants';import CommonButton from'../../components/CommonButton';import Rating from'../../components/Rating';import Comments from'./components/Comments';import AuthProtector from'../../components/AuthProtector';import AuthorizeBanner from'../../components/AuthorizeBanner';import Recommendations from'./components/Recommendation';import CommonWrapper from'../../components/CommonWrapper.styles';import ProductPageWrapper from'./ProductPage.styles';import filledStarIcon from'../../images/star-filled.png';import backArrow from'../../images/back-arrow.png';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ProductPage=function ProductPage(){var _user$ratings;var navigate=useNavigate();var _useState=useState(),_useState2=_slicedToArray(_useState,2),book=_useState2[0],setBook=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isChangeRating=_useState4[0],setIsChangeRating=_useState4[1];var user=useAppSelector(function(state){return state.userReducer.user;});var params=useParams();var setBookInState=function setBookInState(book){setBook(book);};useEffect(function(){try{_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(params.id){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.next=4;return bookApi.getOneBook(params.id);case 4:response=_context.sent;setBookInState(response.data.book);case 6:case\"end\":return _context.stop();}}},_callee);}))();}catch(err){toast.error('Sorry, something went wrong...',{autoClose:3000});}},[params.id]);if(!book)return null;var handleChangeRating=function handleChangeRating(){if(!user){return navigate(routePath.signIn);}setIsChangeRating(!isChangeRating);};var currentUserRating=user===null||user===void 0?void 0:(_user$ratings=user.ratings)===null||_user$ratings===void 0?void 0:_user$ratings.find(function(item){return item.book.bookId===book.bookId;});return/*#__PURE__*/_jsxs(CommonWrapper,{children:[/*#__PURE__*/_jsxs(ProductPageWrapper,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"cover\",children:/*#__PURE__*/_jsx(\"img\",{className:\"cover__img\",src:book.cover})}),/*#__PURE__*/_jsxs(\"div\",{className:\"book-info\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"book-info__title\",children:book.title}),/*#__PURE__*/_jsx(\"p\",{className:\"book-info__subtitle\",children:book.author}),/*#__PURE__*/_jsxs(\"div\",{className:\"rating\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rating__average\",children:[/*#__PURE__*/_jsx(\"img\",{src:filledStarIcon,className:\"icon\"}),/*#__PURE__*/_jsx(\"div\",{className:\"rating__update\",children:book.averageRate})]}),/*#__PURE__*/_jsx(Rating,{bookId:book.bookId,rate:(currentUserRating===null||currentUserRating===void 0?void 0:currentUserRating.rating)||0,isChangeRating:isChangeRating,handleChangeRating:handleChangeRating}),/*#__PURE__*/_jsxs(\"div\",{className:\"rating__update\",onClick:handleChangeRating,children:[/*#__PURE__*/_jsx(\"img\",{className:\"rating__arrow\",src:backArrow}),isChangeRating||!(currentUserRating!==null&&currentUserRating!==void 0&&currentUserRating.rating)?/*#__PURE__*/_jsx(\"p\",{children:\"Rate this book\"}):/*#__PURE__*/_jsx(\"p\",{children:\"Update rating\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"description\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"book-info__subtitle description__title\",children:\"Description\"}),/*#__PURE__*/_jsx(\"p\",{className:\"description__text\",children:book.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons-block\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"button-block__button\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"button-block__description\",children:\"Paperback\"}),/*#__PURE__*/_jsx(CommonButton,{size:\"container\",text:\"Not available\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"button-block__button\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"button-block__description\",children:\"Hardcover\"}),/*#__PURE__*/_jsx(CommonButton,{size:\"container\",text:\"$ \".concat(book.price,\" USD\")})]})]})]})]}),/*#__PURE__*/_jsx(Comments,{setBookInState:setBookInState,book:book}),/*#__PURE__*/_jsx(AuthProtector,{noAuthOnly:true,children:/*#__PURE__*/_jsx(AuthorizeBanner,{})}),/*#__PURE__*/_jsx(Recommendations,{})]});};export default ProductPage;","map":{"version":3,"names":["React","useEffect","useState","useNavigate","useParams","toast","bookApi","useAppSelector","routePath","CommonButton","Rating","Comments","AuthProtector","AuthorizeBanner","Recommendations","CommonWrapper","ProductPageWrapper","filledStarIcon","backArrow","ProductPage","navigate","book","setBook","isChangeRating","setIsChangeRating","user","state","userReducer","params","setBookInState","id","getOneBook","response","data","err","error","autoClose","handleChangeRating","signIn","currentUserRating","ratings","find","item","bookId","cover","title","author","averageRate","rating","description","price"],"sources":["/home/fusion/workspace/frontend/src/ui/pages/productPage/ProductPage.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useNavigate, useParams } from 'react-router';\nimport { toast } from 'react-toastify';\n\nimport bookApi from '../../../api/bookApi';\nimport { useAppSelector } from '../../../store';\nimport { BookType, RatingObj } from '../../../types';\nimport { routePath } from '../../../constants';\n\nimport CommonButton from '../../components/CommonButton';\nimport Rating from '../../components/Rating';\nimport Comments from './components/Comments';\nimport AuthProtector from '../../components/AuthProtector';\nimport AuthorizeBanner from '../../components/AuthorizeBanner';\nimport Recommendations from './components/Recommendation';\nimport CommonWrapper from '../../components/CommonWrapper.styles';\n\nimport ProductPageWrapper from './ProductPage.styles';\n\nimport filledStarIcon from '../../images/star-filled.png';\nimport backArrow from '../../images/back-arrow.png';\n\nconst ProductPage = () => {\n  const navigate = useNavigate();\n  const [book, setBook] = useState<BookType>();\n  const [isChangeRating, setIsChangeRating] = useState(false);\n  const user = useAppSelector((state) => state.userReducer.user);\n  const params = useParams();\n\n  const setBookInState = (book: BookType) => {\n    setBook(book);\n  };\n\n  useEffect(() => {\n    try {\n      (async () => {\n        if (!params.id) return;\n        const response = await bookApi.getOneBook(params.id);\n        setBookInState(response.data.book);\n      })();\n    } catch (err) {\n      toast.error('Sorry, something went wrong...', { autoClose: 3000 });\n    }\n  }, [params.id]);\n\n  if (!book) return null;\n\n  const handleChangeRating = () => {\n    if (!user) {\n      return navigate(routePath.signIn);\n    }\n\n    setIsChangeRating(!isChangeRating);\n  };\n\n  const currentUserRating = user?.ratings?.find((item: RatingObj) => {\n    return item.book.bookId === book.bookId;\n  });\n  return (\n    <CommonWrapper>\n      <ProductPageWrapper>\n        <div className=\"cover\">\n          <img\n            className=\"cover__img\"\n            src={book.cover}\n          />\n        </div>\n        <div className=\"book-info\">\n          <p className=\"book-info__title\">\n            {book.title}\n          </p>\n          <p className=\"book-info__subtitle\">\n            {book.author}\n          </p>\n          <div className=\"rating\">\n            <div className=\"rating__average\">\n              <img\n                src={filledStarIcon}\n                className=\"icon\"\n              />\n              <div className=\"rating__update\">\n                {book.averageRate}\n              </div>\n            </div>\n            <Rating\n              bookId={book.bookId}\n              rate={currentUserRating?.rating || 0}\n              isChangeRating={isChangeRating}\n              handleChangeRating={handleChangeRating}\n            />\n            <div\n              className=\"rating__update\"\n              onClick={handleChangeRating}\n            >\n              <img className=\"rating__arrow\" src={backArrow} />\n              {isChangeRating || !currentUserRating?.rating\n                ? <p>Rate this book</p>\n                : <p>Update rating</p>}\n            </div>\n          </div>\n        </div>\n        <div className=\"description\">\n          <p className=\"book-info__subtitle description__title\">\n            Description\n          </p>\n          <p className=\"description__text\">\n            {book.description}\n          </p>\n          <div className=\"buttons-block\">\n            <div className=\"button-block__button\">\n              <p className=\"button-block__description\">\n                Paperback\n              </p>\n              <CommonButton\n                size=\"container\"\n                text=\"Not available\"\n              />\n            </div>\n            <div className=\"button-block__button\">\n              <p className=\"button-block__description\">\n                Hardcover\n              </p>\n              <CommonButton\n                size=\"container\"\n                text={`$ ${book.price} USD`}\n              />\n            </div>\n          </div>\n        </div>\n      </ProductPageWrapper>\n      <Comments\n        setBookInState={setBookInState}\n        book={book}\n      />\n      <AuthProtector\n        noAuthOnly\n      >\n        <AuthorizeBanner />\n      </AuthProtector>\n      <Recommendations />\n    </CommonWrapper>\n  );\n};\n\nexport default ProductPage;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}